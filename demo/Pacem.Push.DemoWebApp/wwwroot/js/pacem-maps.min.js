/**
 * pacem v0.10.0 (https://js.pacem.it)
 * Copyright 2020 Pacem (https://pacem.it)
 * Licensed under MIT
 */
var Pacem,__decorate=this&&this.__decorate||function(e,t,o,a){var i,r=arguments.length,n=r<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,o):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,a);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(n=(r<3?i(n):r>3?i(t,o,n):i(t,o))||n);return r>3&&n&&Object.defineProperty(t,o,n),n},__awaiter=this&&this.__awaiter||function(e,t,o,a){return new(o||(o=Promise))(function(i,r){function n(e){try{l(a.next(e))}catch(e){r(e)}}function s(e){try{l(a.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(n,s)}l((a=a.apply(e,t||[])).next())})};!function(e){!function(t){!function(o){o.MapConsts={MAP_SELECTOR:e.P+"-map",LINK_SELECTOR:e.P+"-map-link",MARKER_SELECTOR:e.P+"-map-marker",POLYLINE_SELECTOR:e.P+"-map-polyline",CIRCLE_SELECTOR:e.P+"-map-circle",LAYER_SELECTOR:e.P+"-map-layer",DEFAULT_COORDS:{lat:44.71418802507798,lng:10.296516444873811}};o.MapUtils=class MapUtils{static parseCoords(t){if(t&&!isNaN(t.lat)&&!isNaN(t.lng))return[t.lat,t.lng];if(e.Utils.isArray(t)&&t.length>1)return[t[0],t[1]];if(/^\s*(\+|-)?[\d]+(.[\d]+)?\s*,\s*(\+|-)?[\d]+(.[\d]+)?\s*$/.test(t)){var a=t.split(",");return[parseFloat(a[0]),parseFloat(a[1])]}return[o.MapConsts.DEFAULT_COORDS.lat,o.MapConsts.DEFAULT_COORDS.lng]}static expandBounds(e,t){t&&(Array.isArray(t)||(t=[t.lat,t.lng]),e.push(t))}static isContentEmpty(e){return 0==e.children.length}};class MapRelevantElement extends t.PacemEventTarget{get map(){return this._map=this._map||e.CustomElementUtils.findAncestorOfType(this,r)}viewActivatedCallback(){super.viewActivatedCallback(),this.map&&this.map.register(this)}disconnectedCallback(){this.map&&this.map.unregister(this),super.disconnectedCallback()}}__decorate([e.Watch({converter:e.PropertyConverters.Boolean})],MapRelevantElement.prototype,"hide",void 0),o.MapRelevantElement=MapRelevantElement;o.PacemMapAdapterElement=class PacemMapAdapterElement extends t.PacemEventTarget{};class MapEvent extends e.CustomTypedEvent{constructor(e,t){super(e,t)}}o.MapEvent=MapEvent;let a=class PacemMapMarkerElement extends MapRelevantElement{onDragEnd(e){this.position=e,this.dispatchEvent(new MapEvent("dragend",{position:e}))}onInfoOpen(){this.dispatchEvent(new MapEvent("openinfo"))}onInfoClose(){this.dispatchEvent(new MapEvent("closeinfo"))}};__decorate([e.Watch({converter:e.PropertyConverters.Json})],a.prototype,"position",void 0),__decorate([e.Watch({converter:e.PropertyConverters.Json})],a.prototype,"icon",void 0),__decorate([e.Watch({converter:e.PropertyConverters.String})],a.prototype,"caption",void 0),__decorate([e.Watch({converter:e.PropertyConverters.Boolean})],a.prototype,"draggable",void 0),a=__decorate([e.CustomElement({tagName:o.MapConsts.MARKER_SELECTOR})],a),o.PacemMapMarkerElement=a;let i=class PacemMapLayerElement extends MapRelevantElement{};__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.String})],i.prototype,"url",void 0),__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.Json})],i.prototype,"include",void 0),__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.String})],i.prototype,"mode",void 0),__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.Number})],i.prototype,"minZoom",void 0),__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.Number})],i.prototype,"maxZoom",void 0),i=__decorate([e.CustomElement({tagName:o.MapConsts.LAYER_SELECTOR})],i),o.PacemMapLayerElement=i;let r=class PacemMapElement extends t.PacemEventTarget{constructor(){super(...arguments),this.zoom=12,this.center=o.MapConsts.DEFAULT_COORDS,this.scale=!0,this.mousewheel=!0,this.draggable=!0,this.doubleClickZoom=!0,this.keyboardShortcuts=!0,this.autofit=!0,this.paddingTop=0,this.paddingLeft=0,this.paddingRight=0,this.paddingBottom=0,this._drawHandler=(e=>{this._draw(e.target)}),this._initialized=!1,this._afterInit=((t,o)=>{for(var a of(this._initialized=!0,e.CustomElementUtils.findDescendants(this,e=>e instanceof MapRelevantElement)))this._erase(a,o),this._draw(a)}),this._resizeHandler=(e=>{this.onResize(e)})}get container(){return this._container}register(t){t.addEventListener(e.PropertyChangeEventName,this._drawHandler,!1),this._draw(t)}unregister(t){this._erase(t),t.removeEventListener(e.PropertyChangeEventName,this._drawHandler,!1)}_draw(e,t=this.adapter){this._initialized&&t&&t.drawItem(e)}_erase(e,t=this.adapter){this._initialized&&t&&t.removeItem(e)}propertyChangedCallback(t,o,a,i){if(super.propertyChangedCallback(t,o,a,i),"adapter"===t)e.Utils.isNull(this._container)||(this._initialized=!1,this.adapter.initialize(this).then(e=>this._afterInit(e,o)));else{switch(t){case"zoom":case"center":this.adapter&&this.adapter.setView(a);break;case"autofit":a&&this.adapter&&this.adapter.fitBounds()}this.adapter&&this.adapter.invalidateSize()}}viewActivatedCallback(){super.viewActivatedCallback();const t=this._container=document.createElement("div");e.Utils.addClass(t,e.PCSS+"-map"),this.insertAdjacentElement("afterend",t);const o=this._resizer=document.createElement(e.P+"-resize");o.addEventListener("resize",this._resizeHandler,!1),o.target=t,t.insertAdjacentElement("afterend",o),this.adapter&&this.adapter.initialize(this).then(this._afterInit)}disconnectedCallback(){const t=this._resizer;e.Utils.isNull(t)||(t.removeEventListener("resize",this._resizeHandler,!1),t.remove()),super.disconnectedCallback()}onResize(e){this.adapter&&this.adapter.invalidateSize()}};__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.Number})],r.prototype,"zoom",void 0),__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.Json})],r.prototype,"center",void 0),__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.Boolean})],r.prototype,"scale",void 0),__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.Boolean})],r.prototype,"mousewheel",void 0),__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.String})],r.prototype,"zoomControl",void 0),__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.Boolean})],r.prototype,"draggable",void 0),__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.Boolean})],r.prototype,"doubleClickZoom",void 0),__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.Boolean})],r.prototype,"keyboardShortcuts",void 0),__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.Boolean})],r.prototype,"autofit",void 0),__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.Number})],r.prototype,"paddingTop",void 0),__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.Number})],r.prototype,"paddingLeft",void 0),__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.Number})],r.prototype,"paddingRight",void 0),__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.Number})],r.prototype,"paddingBottom",void 0),__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.Element})],r.prototype,"adapter",void 0),r=__decorate([e.CustomElement({tagName:o.MapConsts.MAP_SELECTOR})],r),o.PacemMapElement=r}(t.Maps||(t.Maps={}))}(e.Components||(e.Components={}))}(Pacem||(Pacem={})),function(e){!function(t){!function(t){const o=1e3,a="https://atlas.microsoft.com/sdk/javascript/mapcontrol/2/atlas.min.js",i="https://atlas.microsoft.com/sdk/javascript/mapcontrol/2/atlas.min.css";class AtlasMapUtils{static getPosition(e){return Array.isArray(e)&&(e={lat:e[0],lng:e[1]}),atlas.data.Position.fromLatLng(e)}static getBounds(e){return atlas.data.BoundingBox.fromPositions(e.map(e=>[e[1],e[0]]))}static getLatLng(e){return{lat:e[1],lng:e[0]}}}let r=class PacemAzureMapAdapterElement extends t.PacemMapAdapterElement{constructor(){super(),this._shapes=new Map,this._markersAdapter=new class PacemAzureMarkerAdapter{constructor(e){this.map=e,this.markers=new Map}_onDragEnd(e,t){var o=t.target.getOptions().position;e.onDragEnd(AtlasMapUtils.getLatLng(o))}_onInfo(e){e.onInfoOpen()}_onClose(e){e.onInfoClose()}drawMarker(t){var o,a=this;if(e.Utils.isNull(a.map.map))return;if(e.Utils.isNull(t&&t.position))return void a.map.removeItem(t);var i=AtlasMapUtils.getPosition(t.position);if(a.markers.has(t))o=a.markers.get(t);else{o=new atlas.HtmlMarker;const e=a.map.map;e.markers.add(o,i),e.events.add("click",o,e=>a._openInfoWindow(t,e)),e.events.add("drag",o,()=>a.map.fitBounds(!0)),e.events.add("dragend",o,e=>a._onDragEnd(t,e)),a.markers.set(t,o)}let r={position:i,pixelOffset:[0,-36]},n={position:i,draggable:t.draggable,popup:new atlas.Popup},s=(e,t,o)=>`<img width="${t||"auto"}" height="${o||"auto"}" style="pointer-events: none" src="${e}" />`;if("string"==typeof t.icon)n.htmlContent=s(t.icon);else if(!e.Utils.isNull(t.icon)){const e=t.icon.size,o=t.icon.anchor;n.htmlContent=s(t.icon.url,e&&e.width,e&&e.height),o?(n.anchor="top-left",n.pixelOffset=[-o.x,-o.y],r.pixelOffset=[0,-o.y]):e&&e.height&&(r.pixelOffset=[0,-e.height/2])}n.popup.setOptions(r),n.text=t.caption,o.setOptions(n)}_openInfoWindow(o,a){var i=this,r=a.target||i.markers.get(o),n=o.caption,s=r.getOptions().popup;s&&(t.MapUtils.isContentEmpty(o)||(n=o.innerHTML),e.Utils.isNullOrEmpty(n)||(s.setOptions({content:`<div style="padding: 24px;">${n}</div>`}),r.togglePopup(),i._onInfo(o),i.map.map.events.addOnce("close",s,e=>{s.setOptions({content:""}),i._onClose(o)})))}}(this)}setView(t,o){const a=this._map;e.Utils.isNull(a)||("number"==typeof t?a.setCamera({zoom:t}):a.setCamera({position:AtlasMapUtils.getPosition(t),zoom:o}))}get map(){return this._map}_isMapInitialized(){return!e.Utils.isNull(this._map)}initialize(o){return __awaiter(this,void 0,void 0,function*(){yield Promise.all([e.CustomElementUtils.importjs(a),e.CustomElementUtils.importcss(i)]);const r=this._container=o;var n=r.scale,s=r.draggable,l=r.doubleClickZoom,p=r.keyboardShortcuts,d={center:AtlasMapUtils.getPosition(r.center),zoom:r.zoom,subscriptionKey:this.subscriptionKey,dragPanInteraction:s,scrollZoomInteraction:r.mousewheel,dblClickZoomInteraction:!l,keyboardInteraction:p,language:e.Utils.lang(o)},c=r.container,m=document.createElement("div");m.id=`azure-maps-${e.Utils.uniqueCode()}`,m.style.width="100%",m.style.height="100%",c.innerHTML="",c.appendChild(m);var h=this._map=new atlas.Map(m.id,d);return n&&r.zoomControl&&h.events.addOnce("ready",e=>{let t=atlas.ControlPosition.NonFixed;switch(r.zoomControl){case"topleft":t=atlas.ControlPosition.TopLeft;break;case"topright":t=atlas.ControlPosition.TopRight;break;case"bottomright":t=atlas.ControlPosition.BottomRight;break;case"bottomleft":t=atlas.ControlPosition.BottomLeft}h.controls.add(new atlas.control.ZoomControl,{position:t})}),h.events.add("moveend",()=>this._idleFiller()),h.events.addOnce("ready",()=>{o.dispatchEvent(new t.MapEvent("maploaded")),this._idleFiller()}),m})}invalidateSize(){this.map&&this.map.resize()}removeItem(o){if(o instanceof t.PacemMapMarkerElement){var a=this._markersAdapter,i=a.markers.get(o);e.Utils.isNull(i)||(this.map.markers.remove(i),a.markers.delete(o))}this.fitBounds(!0)}drawItem(e){if(e instanceof t.PacemMapMarkerElement){var o=this._markersAdapter,a=o.drawMarker(e);o.markers.has(e)||o.markers.set(e,a)}this.fitBounds(!0)}_idleFiller(){}fitBounds(o){if(this.map){var a=this._container;if(a.autofit||!0!==o){var i=this._markersAdapter.markers,r=this._shapes;if(i.size||r.size){var n=[];for(var s of i.keys()){let o=i.get(s);e.Utils.isNull(o)||t.MapUtils.expandBounds(n,AtlasMapUtils.getLatLng(o.getOptions().position))}for(var l of r.keys()){var p=r.get(l).getBounds();t.MapUtils.expandBounds(n,AtlasMapUtils.getLatLng(atlas.data.BoundingBox.getSouthWest(p))),t.MapUtils.expandBounds(n,AtlasMapUtils.getLatLng(atlas.data.BoundingBox.getNorthEast(p)))}var d=a.paddingTop||0,c=a.paddingLeft||0,m=a.paddingRight||0,h=a.paddingBottom||0;n.length>=2?this._map.setCamera({bounds:AtlasMapUtils.getBounds(n),padding:{top:d,bottom:h,left:c,right:m}}):1===n.length&&this._map.setCamera({center:AtlasMapUtils.getPosition(n[0]),zoom:a.zoom})}else this._map.setCamera({center:AtlasMapUtils.getPosition(a.center),zoom:a.zoom})}}}};__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.String})],r.prototype,"subscriptionKey",void 0),__decorate([e.Debounce(500)],r.prototype,"_idleFiller",null),__decorate([e.Debounce(o)],r.prototype,"fitBounds",null),r=__decorate([e.CustomElement({tagName:e.P+"-map-adapter-azure"})],r),t.PacemAzureMapAdapterElement=r}(t.Maps||(t.Maps={}))}(e.Components||(e.Components={}))}(Pacem||(Pacem={})),function(e){!function(t){!function(t){const o=1e3,a="https://maps.googleapis.com/maps/api/js";class GMapsUtils{static getPosition(e){return Array.isArray(e)&&(e={lat:e[0],lng:e[1]}),e}}let i=class PacemGoogleMapAdapterElement extends t.PacemMapAdapterElement{constructor(){super(),this._shapes=new Map,this._markersAdapter=new class PacemGoogleMarkerAdapter{constructor(e){this.map=e,this.markers=new Map,this.infoWindows=new Map}_onDragEnd(e,t){const o=this.markers.get(e).getPosition(),a={lat:o.lat(),lng:o.lng()};e.onDragEnd(a)}_onInfo(e){e.onInfoOpen()}_onClose(e){e.onInfoClose()}drawMarker(t){var o=this;if(!e.Utils.isNull(o.map.map))if(e.Utils.isNull(t&&t.position))o.map.removeItem(t);else{var a;if(o.markers.has(t)?a=o.markers.get(t):((a=new google.maps.Marker({position:{lat:0,lng:0},map:o.map.map})).addListener("click",e=>o._openInfoWindow(t,e)),a.addListener("drag",()=>o.map.fitBounds(!0)),a.addListener("dragend",e=>o._onDragEnd(t,e)),o.markers.set(t,a)),a.setPosition(GMapsUtils.getPosition(t.position)),"string"==typeof t.icon)a.setIcon(t.icon);else if(!e.Utils.isNull(t.icon)){let o={url:t.icon.url};e.Utils.isNullOrEmpty(t.icon.size)||e.Utils.extend(o,{size:new google.maps.Size(t.icon.size.width,t.icon.size.height),anchor:new google.maps.Point(t.icon.size.width/2,t.icon.size.height)}),e.Utils.isNullOrEmpty(t.icon.anchor)||e.Utils.extend(o,{anchor:new google.maps.Point(t.icon.anchor.x,t.icon.anchor.y)}),a.setIcon(o)}a.setLabel(t.caption),a.setDraggable(t.draggable)}}_openInfoWindow(o,a){var i,r=this,n=r.markers.get(o),s=o.caption;t.MapUtils.isContentEmpty(o)||(s=o.innerHTML),e.Utils.isNullOrEmpty(s)||(r.infoWindows.has(o)?i=r.infoWindows.get(o):((i=new google.maps.InfoWindow).addListener("closeclick",function(){r._onClose(o)}),r.infoWindows.set(o,i)),i.setContent(s),i.open(r.map.map,n),r._onInfo(o))}}(this)}setView(t,o){const a=this._map;e.Utils.isNull(a)||("number"==typeof t?a.setZoom(t):(a.setCenter(t),o&&a.setZoom(o)))}get map(){return this._map}propertyChangedCallback(e,t,o,a){super.propertyChangedCallback(e,t,o,a),this.invalidateSize()}initialize(o){return __awaiter(this,void 0,void 0,function*(){yield e.CustomElementUtils.importjs(a+"?key="+this.apiKey);const i=this._container=o;if(e.Utils.isNull(google&&google.maps))return;var r=i.scale,n=i.draggable,s=i.doubleClickZoom,l=i.keyboardShortcuts;const p=t.MapUtils.parseCoords(i.center);var d=new google.maps.LatLng(p[0],p[1]),c={zoomControl:r&&!e.Utils.isNullOrEmpty(i.zoomControl),zoomControlOptions:{position:function(e){switch(i.zoomControl){case"topright":return google.maps.ControlPosition.RIGHT_TOP;case"bottomleft":return google.maps.ControlPosition.LEFT_BOTTOM;case"bottomright":return google.maps.ControlPosition.RIGHT_BOTTOM;default:return google.maps.ControlPosition.LEFT_TOP}}()},scrollwheel:i.mousewheel,disableDoubleClickZoom:s,keyboardShortcuts:l,draggable:n},m=i.container,h=document.createElement("div");h.style.width="100%",h.style.height="100%",m.innerHTML="",m.appendChild(h);var g=this._map=new google.maps.Map(h,c);if(r&&i.zoomControl){var u=google.maps.ControlPosition.TOP_LEFT;switch(i.zoomControl){case"topright":u=google.maps.ControlPosition.TOP_RIGHT;break;case"bottomleft":u=google.maps.ControlPosition.BOTTOM_LEFT;break;case"bottomright":u=google.maps.ControlPosition.BOTTOM_RIGHT}var _={position:u};g.setOptions({zoomControlOptions:_})}g.addListener("dragend",()=>this._idleFiller()),g.addListener("center_changed",()=>this._idleFiller()),g.setCenter(d),g.setZoom(i.zoom);var v=g.addListener("idle",function(e){v.remove(),o.dispatchEvent(new t.MapEvent("maploaded"))});const f=t.MapUtils.parseCoords(i.center),C=new google.maps.LatLng(f[0],f[1]);return g.setCenter(C),g.setZoom(i.zoom),h})}invalidateSize(){this.map&&google.maps.event.trigger(this.map,"resize")}removeItem(o){if(o instanceof t.PacemMapMarkerElement){var a=this._markersAdapter,i=a.markers.get(o);e.Utils.isNull(i)||(i.setMap(null),a.markers.delete(o))}this.fitBounds(!0)}drawItem(e){if(e instanceof t.PacemMapMarkerElement){var o=this._markersAdapter,a=o.drawMarker(e);o.markers.has(e)||o.markers.set(e,a)}this.fitBounds(!0)}_idleFiller(){this.map&&google.maps.event.trigger(this.map,"idle")}fitBounds(t){if(!this.map)return;const o=this._container;if(!o.autofit&&!0===t)return;const a=this._markersAdapter.markers,i=this._shapes,r=this._map;if(!a.size&&!i.size)return r.setCenter(o.center),void r.setZoom(o.zoom);var n=new google.maps.LatLngBounds,s=0;for(var l of a.keys()){let t=a.get(l);if(e.Utils.isNull(t))continue;const o=t.getPosition();o&&(n.extend({lat:o.lat(),lng:o.lng()}),s++)}for(var p of i.keys()){var d=i.get(p).getBounds();const e=d.getSouthWest(),t=d.getNorthEast();n.extend({lat:e.lat(),lng:e.lng()}),n.extend({lat:t.lat(),lng:t.lng()}),s+=2}s>=2?r.fitBounds(n):1==s&&(r.setCenter(n.getCenter()),r.setZoom(o.zoom)),this._padBounds()}_padBounds(){const e=this._container,t=e.paddingTop||0,o=e.paddingLeft||0,a=e.paddingRight||0,i=e.paddingBottom||0;if(o||t||a||i){const e=this._map;var r=e.getBounds();const l=e.getDiv().clientWidth,p=e.getDiv().clientHeight;var n=e.getProjection().fromPointToLatLng(new google.maps.Point(-o,-t)),s=e.getProjection().fromPointToLatLng(new google.maps.Point(l+a,p+i));r.extend(n),r.extend(s)}}_redrawMap(){}};__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.String})],i.prototype,"apiKey",void 0),__decorate([e.Debounce(500)],i.prototype,"_idleFiller",null),__decorate([e.Debounce(o)],i.prototype,"fitBounds",null),i=__decorate([e.CustomElement({tagName:e.P+"-map-adapter-google"})],i),t.PacemGoogleMapAdapterElement=i}(t.Maps||(t.Maps={}))}(e.Components||(e.Components={}))}(Pacem||(Pacem={})),function(e){!function(t){!function(t){const o=1e3,a="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js",i="sha512-GffPMF3RvMeYyc1LWMHtK8EbPv0iNZ8/oTtHPx9/cc2ILxQ+u905qIwdpULaqDkyBKgOaB57QTMg7ztg8Jm2Og==",r="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css",n="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==";let s=class PacemLeafletMapAdapterElement extends t.PacemMapAdapterElement{constructor(){super(),this.tiles="//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",this.attribution='Map data © <a href="http://openstreetmap.org">OpenStreetMap</a> contributors',this._tileLayer=null,this._shapes=new Map,this._markersAdapter=new class PacemLeafletMarkerAdapter{constructor(e){this._map=e,this._markers=new Map}get markers(){return this._markers}_onDragEnd(e,t){var o=t.target.getLatLng();e.onDragEnd(o)}_onInfo(e){e.onInfoOpen()}_onClose(e){e.onInfoClose()}drawMarker(t){var o=this;if(!e.Utils.isNull(o._map.map))if(e.Utils.isNullOrEmpty(t&&t.position)||t&&t.hide)e.Utils.isNull(t)||(o._map.removeItem(t),this._markers.delete(t));else{var a;if(o._markers.has(t)?a=o._markers.get(t):((a=L.marker(t.position).addTo(o._map.map)).on("click",e=>o._openInfoWindow(t,e)),a.on("drag",()=>o._map.fitBounds(!0)),a.on("dragend",e=>o._onDragEnd(t,e)),o._markers.set(t,a)),a.setLatLng(t.position),"string"==typeof t.icon)o._setIcon(a,t.icon);else if(!e.Utils.isNull(t.icon)){let i={iconUrl:t.icon.url};e.Utils.isNullOrEmpty(t.icon.size)||e.Utils.extend(i,{iconSize:[t.icon.size.width,t.icon.size.height],iconAnchor:[t.icon.size.width/2,t.icon.size.height],popupAnchor:[0,-t.icon.size.height]}),e.Utils.isNullOrEmpty(t.icon.anchor)||e.Utils.extend(i,{iconAnchor:[t.icon.anchor.x,t.icon.anchor.y]}),o._setIcon(a,new L.Icon(i))}o._setCaption(a,t.caption),o._setDraggable(a,t.draggable)}}_openInfoWindow(o,a){var i=this,r=a.target||i._markers.get(o),n=o.caption;t.MapUtils.isContentEmpty(o)||(n=o.innerHTML),e.Utils.isNullOrEmpty(n)||(r.bindPopup(n).openPopup(),i._onInfo(o),r.on("popupclose",function(){r.unbindPopup(),i._onClose(o)}))}_setDraggable(e,t){!0===t?e.dragging.enable():e.dragging.disable()}_setIcon(e,t){if("string"==typeof t){var o,a,i,r={iconUrl:t};if((o=this.size)&&/[\d]+,[\d]+/.test(o)){var n=-1,s=[parseInt(o.substring(0,n=o.indexOf(","))),parseInt(o.substring(n+1))];Object.assign(r,{iconSize:s})}if((a=this.anchor)&&/[\d]+,[\d]+/.test(a)){n=-1;var l=[parseInt(a.substring(0,n=a.indexOf(","))),parseInt(a.substring(n+1))];Object.assign(r,{iconAnchor:l,popupAnchor:[0,-l[1]]})}(i=this.popupAnchor)&&/[\d]+,[\d]+/.test(i)&&(n=-1,l=[parseInt(a.substring(0,n=a.indexOf(","))),parseInt(a.substring(n+1))],Object.assign(r,{popupAnchor:l})),e.setIcon(L.icon(r))}else t&&e.setIcon(t)}_setCaption(e,t){e.getPopup()&&e.getPopup().getContent()!=t&&e.setPopupContent(t)}removeMarker(e){const t=this._markers;t.has(e)&&(t.get(e).remove(),t.delete(e))}}(this),this._layersAdapter=new class PacemLeafletLayerAdapter{constructor(e){this._map=e,this._layers=new Map}drawLayer(e){const t=this._layers;if(t.has(e)){let o=t.get(e);o&&o.remove()}if(e.hide)return void t.delete(e);const o=(e.mode||"").toLowerCase(),a=this._map.map;switch(o){case"wms":let i=L.tileLayer.wms(e.url,{layers:(e.include||[]).join(","),minZoom:e.minZoom,maxZoom:e.maxZoom,transparent:!0,format:"image/png"}).addTo(a);t.set(e,i);break;default:let r=L.tileLayer(e.url,{tms:"tms"===o,minZoom:e.minZoom,maxZoom:e.maxZoom}).addTo(a);t.set(e,r)}}removeLayer(e){const t=this._layers;t.has(e)&&(t.get(e).remove(),t.delete(e))}}(this)}setView(t,o){const a=this._map;e.Utils.isNull(a)||("number"==typeof t?a.setZoom(t):a.setView(t,o||a.getZoom()))}get map(){return this._map}propertyChangedCallback(e,t,o,a){switch(super.propertyChangedCallback(e,t,o,a),e){case"tiles":this._redrawMap()}this.invalidateSize()}initialize(o){return __awaiter(this,void 0,void 0,function*(){yield Promise.all([e.CustomElementUtils.importjs(a,i,!0),e.CustomElementUtils.importcss(r,n,!0)]);const s=this._container=o;var l=s.scale,p=s.draggable,d=s.doubleClickZoom,c=s.keyboardShortcuts,m=L.latLng(t.MapUtils.parseCoords(s.center)),h={zoomControl:l&&!e.Utils.isNullOrEmpty(s.zoomControl),scrollWheelZoom:s.mousewheel,dragging:p,doubleClickZoom:!d,keyboard:c},g=s.container,u=document.createElement("div");u.style.width="100%",u.style.height="100%",g.innerHTML="",g.appendChild(u);var _=this._map=L.map(u,h);_.on("zoomend",e=>{s.zoom=_.getZoom()}),_.on("moveend",()=>this._idleFiller()),_.on("load",()=>{l&&s.zoomControl&&_.zoomControl.setPosition(s.zoomControl),this._idleFiller()}),this._tileLayer=L.tileLayer(this.tiles,{attribution:this.attribution}).addTo(_),_.setView(m,s.zoom),_.once("idle",function(){_.fire("resize"),o.dispatchEvent(new t.MapEvent("maploaded"))});const v=t.MapUtils.parseCoords(s.center),f=[v[0],v[1]];return _.setView(f,s.zoom),u})}invalidateSize(){this.map&&this.map.invalidateSize()}removeItem(e){e instanceof t.PacemMapMarkerElement?this._markersAdapter.removeMarker(e):e instanceof t.PacemMapLayerElement&&this._layersAdapter.removeLayer(e),this.fitBounds(!0)}drawItem(e){e instanceof t.PacemMapMarkerElement?this._markersAdapter.drawMarker(e):e instanceof t.PacemMapLayerElement&&this._layersAdapter.drawLayer(e),this.fitBounds(!0)}_idleFiller(){this.map&&this.map.fire("idle")}fitBounds(o){if(this.map){var a=this._container;if(a.autofit||!0!==o){var i=this._markersAdapter.markers,r=this._shapes;if(i.size||r.size){var n=[];for(var s of i.keys()){let o=i.get(s);e.Utils.isNull(o)||t.MapUtils.expandBounds(n,o.getLatLng())}for(var l of r.keys()){var p=r.get(l).getBounds();t.MapUtils.expandBounds(n,p.getSouthWest()),t.MapUtils.expandBounds(n,p.getNorthEast())}var d=a.paddingTop,c=a.paddingLeft,m=a.paddingRight,h=a.paddingBottom,g={paddingTopLeft:new L.Point(c,d),paddingBottomRight:new L.Point(m,h)};if(n.length>=2||1==n.length&&(d||c||h||m)){const e=L.latLngBounds(n),t=e.getNorthEast(),o=e.getSouthWest();try{this.map.fitBounds([[t.lat,t.lng],[o.lat,o.lng]],g)}catch(e){throw e}}else 1==n.length&&this.map.setView(n[0],a.zoom)}else this._map.setView(t.MapUtils.parseCoords(a.center),a.zoom)}}}_redrawMap(){e.Utils.isNull(this.tiles&&this._tileLayer)||this._tileLayer.setUrl(this.tiles)}};__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.String})],s.prototype,"tiles",void 0),__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.String})],s.prototype,"attribution",void 0),__decorate([e.Debounce(500)],s.prototype,"_idleFiller",null),__decorate([e.Debounce(o)],s.prototype,"fitBounds",null),s=__decorate([e.CustomElement({tagName:e.P+"-map-adapter-leaflet"})],s),t.PacemLeafletMapAdapterElement=s}(t.Maps||(t.Maps={}))}(e.Components||(e.Components={}))}(Pacem||(Pacem={}));