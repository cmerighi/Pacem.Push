/**
 * pacem v0.10.0 (https://js.pacem.it)
 * Copyright 2020 Pacem (https://pacem.it)
 * Licensed under MIT
 */
var Pacem,__decorate=this&&this.__decorate||function(e,t,r,i){var s,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(a=(n<3?s(a):n>3?s(t,r,a):s(t,r))||a);return n>3&&a&&Object.defineProperty(t,r,a),a};!function(e){!function(e){!function(e){e.Pacem3DDetector=class Pacem3DDetector{constructor(){this._detected={supported:!1,info:{}};let e,t=document.createElement("canvas"),r=["webgl","experimental-webgl","moz-webgl","webkit-3d"],i=function(t){if(t)return e.getParameter(t)},s=(e,t,r)=>{let i=this._detected;(i.info[e]=i.info[e]||{})[t=(t=t.replace(/[^\w]+/g,"")).substring(0,1).toLowerCase()+t.substring(1)]=r};if(navigator.userAgent.indexOf("MSIE")>=0)try{e=window.WebGLHelper.CreateGLContext(t,"canvas")}catch(e){}else for(var n=0;n<r.length;n++)try{if(e=t.getContext(r[n])){s("main","Context Name",r[n]);break}}catch(e){}this._detected.supported=!!e,s("main","Platform",navigator.platform),s("main","Agent",navigator.userAgent),e&&(s("main","Vendor",i(e.VENDOR)),s("main","Version",i(e.VERSION)),s("main","Renderer",i(e.RENDERER)),s("main","Shading Language Version",i(e.SHADING_LANGUAGE_VERSION)),s("bits","Rgba Bits",i(e.RED_BITS)+", "+i(e.GREEN_BITS)+", "+i(e.BLUE_BITS)+", "+i(e.ALPHA_BITS)),s("bits","Depth Bits",i(e.DEPTH_BITS)),s("shader","Max Vertex Attribs",i(e.MAX_VERTEX_ATTRIBS)),s("shader","Max Vertex Texture Image Units",i(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS)),s("shader","Max Varying Vectors",i(e.MAX_VARYING_VECTORS)),s("shader","Max Uniform Vectors",i(e.MAX_VERTEX_UNIFORM_VECTORS)),s("tex","Max Combined Texture Image Units",i(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS)),s("tex","Max Texture Size",i(e.MAX_TEXTURE_SIZE)),s("tex","Max Cube Map Texture Size",i(e.MAX_CUBE_MAP_TEXTURE_SIZE)),s("tex","Num. Compressed Texture Formats",i(e.COMPRESSED_TEXTURE_FORMATS)),s("misc","Max Render Buffer Size",i(e.MAX_RENDERBUFFER_SIZE)),s("misc","Max Viewport Dimensions",i(e.MAX_VIEWPORT_DIMS)),s("misc","Aliased Line Width Range",i(e.ALIASED_LINE_WIDTH_RANGE)),s("misc","Aliased Point Size Range",i(e.ALIASED_POINT_SIZE_RANGE)),s("misc","Supported Extensions",e.getSupportedExtensions()||[]))}get info(){return this._detected.info}get supported(){return this._detected.supported}}}(e.ThreeD||(e.ThreeD={}))}(e.Components||(e.Components={}))}(Pacem||(Pacem={})),function(e){!function(t){!function(r){const i={OBJECT_SELECTOR:e.P+"-3d-object",LIGHT_SELECTOR:e.P+"-3d-light",CAMERA_SELECTOR:e.P+"-3d-camera",SCENE_SELECTOR:e.P+"-3d",DEFAULT_COORDS:{x:0,y:0,z:0}};class ThreeDRelevantElementEvent extends e.CustomTypedEvent{constructor(e,t){super(e,t)}}r.ThreeDRelevantElementEvent=ThreeDRelevantElementEvent;class ThreeDRelevantElement extends t.PacemEventTarget{constructor(){super(...arguments),this.position=i.DEFAULT_COORDS}get scene(){return this._scene=this._scene||e.CustomElementUtils.findAncestorOfType(this,o)}viewActivatedCallback(){super.viewActivatedCallback(),this.scene&&this.scene.register(this)}disconnectedCallback(){super.viewActivatedCallback(),this.scene&&this.scene.unregister(this)}}__decorate([e.Watch({converter:e.PropertyConverters.Json})],ThreeDRelevantElement.prototype,"position",void 0),__decorate([e.Watch({emit:!1,reflectBack:!0,converter:e.PropertyConverters.String})],ThreeDRelevantElement.prototype,"tag",void 0),r.ThreeDRelevantElement=ThreeDRelevantElement;let s=class Pacem3DObjectElement extends ThreeDRelevantElement{constructor(){super(...arguments),this.format="json"}};__decorate([e.Watch()],s.prototype,"mesh",void 0),__decorate([e.Watch({converter:e.PropertyConverters.String})],s.prototype,"url",void 0),__decorate([e.Watch({converter:e.PropertyConverters.String})],s.prototype,"format",void 0),s=__decorate([e.CustomElement({tagName:i.OBJECT_SELECTOR})],s),r.Pacem3DObjectElement=s;let n=class Pacem3DLightElement extends ThreeDRelevantElement{constructor(){super(...arguments),this.intensity=.25,this.target=i.DEFAULT_COORDS,this.color="#fff",this.type="omni"}};__decorate([e.Watch({converter:e.PropertyConverters.Number})],n.prototype,"intensity",void 0),__decorate([e.Watch({converter:e.PropertyConverters.Json})],n.prototype,"target",void 0),__decorate([e.Watch({converter:e.PropertyConverters.String})],n.prototype,"color",void 0),__decorate([e.Watch({converter:e.PropertyConverters.String})],n.prototype,"type",void 0),n=__decorate([e.CustomElement({tagName:i.LIGHT_SELECTOR})],n),r.Pacem3DLightElement=n;let a=class Pacem3DCameraElement extends ThreeDRelevantElement{constructor(){super(...arguments),this.fov=45,this.aspect=1.78,this.near=.1,this.far=1e3,this.type="perspective",this.lookAt=i.DEFAULT_COORDS}};__decorate([e.Watch({converter:e.PropertyConverters.Number})],a.prototype,"fov",void 0),__decorate([e.Watch({converter:e.PropertyConverters.Number})],a.prototype,"aspect",void 0),__decorate([e.Watch({converter:e.PropertyConverters.Number})],a.prototype,"near",void 0),__decorate([e.Watch({converter:e.PropertyConverters.Number})],a.prototype,"far",void 0),__decorate([e.Watch({converter:e.PropertyConverters.String})],a.prototype,"type",void 0),__decorate([e.Watch({converter:e.PropertyConverters.Json})],a.prototype,"lookAt",void 0),a=__decorate([e.CustomElement({tagName:i.CAMERA_SELECTOR})],a),r.Pacem3DCameraElement=a;r.Pacem3DAdapterElement=class Pacem3DAdapterElement extends t.PacemEventTarget{};let o=class Pacem3DElement extends t.PacemEventTarget{constructor(){super(...arguments),this.interactive=!1,this.orbit=!1,this._bag=new Set,this._addHandler=(e=>{this._add(e.target)}),this._clickHandler=(t=>{let r=this;r.interactive&&!e.Utils.isNull(r._lastHover)&&(r._lastHover.dispatchEvent(new ThreeDRelevantElementEvent("click",{element:r._lastHover})),r.dispatchEvent(new ThreeDRelevantElementEvent("itemclick",{element:r._lastHover})))}),this._moveHandler=(t=>{let r=this;if(!r.adapter||!r.interactive)return;let i=r.adapter.raycast({x:t.clientX,y:t.clientY});i!=r._lastHover&&(e.Utils.isNull(r._lastHover)||(r._lastHover.dispatchEvent(new ThreeDRelevantElementEvent("out",{element:r._lastHover})),r.dispatchEvent(new ThreeDRelevantElementEvent("itemout",{element:r._lastHover}))),e.Utils.isNull(i)||(i.dispatchEvent(new ThreeDRelevantElementEvent("over",{element:i})),r.dispatchEvent(new ThreeDRelevantElementEvent("itemover",{element:i}))),r._lastHover=i)}),this._resizeHandler=(e=>{this._onResize(e)})}get stage(){return this._container}register(t){this._bag.has(t)||(this._bag.add(t),this._add(t),t.addEventListener(e.PropertyChangeEventName,this._addHandler,!1))}unregister(t){this._bag.has(t)&&(this._bag.delete(t),t.removeEventListener(e.PropertyChangeEventName,this._addHandler,!1),this._erase(t))}_add(e){this.adapter&&this.adapter.addItem(e)}_erase(e){this.adapter&&this.adapter.removeItem(e)}_initializeAdapter(t,r){e.Utils.isNull(t)||this._bag.forEach(e=>t.removeItem(e)),e.Utils.isNull(this._container)||e.Utils.isNull(r)||(r.initialize(this),this._bag.forEach(e=>this._add(e)),this.render())}propertyChangedCallback(t,r,i,s){super.propertyChangedCallback(t,r,i,s),e.Utils.isNull(this._container)||("adapter"===t?this._initializeAdapter(r,i):"disabled"===t&&this.render())}viewActivatedCallback(){super.viewActivatedCallback();const t=this._container=document.createElement("div");e.Utils.addClass(t,e.PCSS+"-3d-stage"),this.insertAdjacentElement("afterend",t);const r=this._resizer=document.createElement(e.P+"-resize");r.addEventListener("resize",this._resizeHandler,!1),r.target=t,t.insertAdjacentElement("afterend",r),this._initializeAdapter(null,this.adapter),t.addEventListener("mousemove",this._moveHandler,!1),t.addEventListener("click",this._clickHandler,!1)}disconnectedCallback(){const t=this._resizer,r=this._container;e.Utils.isNull(r)||(r.removeEventListener("click",this._clickHandler,!1),r.removeEventListener("mousemove",this._moveHandler,!1)),e.Utils.isNull(t)||(t.removeEventListener("resize",this._resizeHandler,!1),t.remove()),super.disconnectedCallback()}_onResize(e){this.adapter&&this.adapter.invalidateSize()}render(){if(!this.disabled){let e=new CustomEvent("prerender",{detail:{scene:this.adapter.scene},cancelable:!0});this.dispatchEvent(e),e.defaultPrevented||(this.adapter.render(),this.dispatchEvent(new CustomEvent("render",{detail:{scene:this.adapter.scene}})))}requestAnimationFrame(()=>this.render())}};__decorate([e.Watch({converter:e.PropertyConverters.Boolean})],o.prototype,"interactive",void 0),__decorate([e.Watch({converter:e.PropertyConverters.Boolean})],o.prototype,"orbit",void 0),__decorate([e.Watch({emit:!1})],o.prototype,"adapter",void 0),o=__decorate([e.CustomElement({tagName:i.SCENE_SELECTOR})],o),r.Pacem3DElement=o}(t.ThreeD||(t.ThreeD={}))}(e.Components||(e.Components={}))}(Pacem||(Pacem={})),function(e){!function(t){!function(t){let r=class PacemThreeAdapterElement extends t.Pacem3DAdapterElement{constructor(){super(...arguments),this._renderer=null,this._camera=null,this._scene=null,this._orbitCtrls=null,this._objects=new Map,this._lights=new Map,this._dict={},this._orbitControlsDelegate=(e=>{})}project(t){if(e.Utils.isNull(this._camera)||e.Utils.isNull(this._stage))return null;const r=new THREE.Vector3(t.x,t.y,t.z),i=this._stage.width/2,s=this._stage.height/2,n=r.project(this._camera);return{x:n.x*i+i,y:-n.y*s+s}}get scene(){return this._scene}raycast(t){let r=this._3d.stage,i=this._camera,s=e.Utils.offset(r),n=new THREE.Vector2((t.x-s.left)/r.clientWidth*2-1,-(t.y-s.top)/r.clientHeight*2+1),a=new THREE.Raycaster;a.setFromCamera(n,i);let o,c=a.intersectObjects(this._scene.children);return c.length>0&&(o=c[0].object)?this._dict[o.id]:null}initialize(e){this._3d=e;const t=e.stage,r=this._stage=document.createElement("canvas");t.innerHTML="",t.appendChild(r),this._scene=new THREE.Scene,this.invalidateSize();let i=this._stage.width,s=this._stage.height,n={canvas:r,antialias:!0,stencil:!1,alpha:!0};return this._renderer=new THREE.WebGLRenderer(n),this._renderer.setSize(i,s),r}_setCamera(e){this._camera=e,this.invalidateSize(),this._disposeOrbitControls(),this.orbit&&this._initOrbitControls()}propertyChangedCallback(e,t,r,i){super.propertyChangedCallback(e,t,r,i),"orbit"===e&&(!0===r?this._initOrbitControls():this._disposeOrbitControls())}_initOrbitControls(){e.Utils.isNull(this._3d)||(this._orbitCtrls=new THREE.OrbitControls(this._camera,this._3d.stage)).addEventListener("change",this._orbitControlsDelegate)}_disposeOrbitControls(){e.Utils.isNull(this._orbitCtrls)||(this._orbitCtrls.removeEventListener("change",this._orbitControlsDelegate),this._orbitCtrls.dispose())}invalidateSize(){if(!this._3d)return;let e=this._3d.stage.clientWidth,t=this._3d.stage.clientHeight;this._stage.width=e,this._stage.height=t;let r=this._camera;r instanceof THREE.PerspectiveCamera&&(r.aspect=e/t,r.updateProjectionMatrix()),this._renderer&&this._renderer.setSize(e,t)}removeItem(r){var i=this._objects;r instanceof t.Pacem3DLightElement&&(i=this._lights);var s=i.get(r);return e.Utils.isNull(s)||(this._scene.remove(s),delete this._dict[s.id],i.delete(r)),e.Utils.fromResult({})}addItem(r){var i=e.DeferPromise.defer();if(r instanceof t.Pacem3DObjectElement){const t=t=>{let s=r.position;t.position.x=s.x,t.position.y=s.y,t.position.z=s.z,t.userData=r.tag,e.Utils.isNull(this._scene.getObjectById(t.id))&&(this._scene.add(t),this._dict[t.id]=r),i.resolve()};if(this._objects.has(r))t(this._objects.get(r));else{const s=e=>{e?(t(e),this._objects.set(r,e)):i.reject()};switch(r.format){case"json":let t=new THREE.JSONLoader;if(e.Utils.isNullOrEmpty(r.mesh))e.Utils.isNullOrEmpty(r.url)?i.reject():t.load(r.url,(e,t)=>{s(new THREE.Mesh(e,t&&t.length&&t[0]||new THREE.MeshLambertMaterial))});else{let e=t.parse(JSON.parse(r.mesh)),i=e.materials;s(new THREE.Mesh(e.geometry,i&&i.length&&i[0]||new THREE.MeshLambertMaterial))}break;case"native":s(r.mesh)}}}else if(r instanceof t.Pacem3DLightElement){const t=t=>{let s=r.position;t.position.set(s.x,s.y,s.z),t.userData=r.tag,e.Utils.isNull(this._scene.getObjectById(t.id))&&(this._scene.add(t),this._lights.set(r,t)),i.resolve()};var s=this._lights.get(r);switch(r.type){case"spot":s instanceof THREE.SpotLight||(this._scene.remove(s),s=new THREE.SpotLight),s.target.position.set(r.target.x,r.target.y,r.target.z);break;default:s instanceof THREE.PointLight||(this._scene.remove(s),s=new THREE.PointLight)}s.position.set(r.position.x,r.position.y,r.position.z),s.color=new THREE.Color(r.color),s.visible=!r.disabled,s.intensity=r.intensity,t(s)}else if(r instanceof t.Pacem3DCameraElement){if("perspective"===r.type){if(this._camera instanceof THREE.PerspectiveCamera)var n=this._camera;else n=new THREE.PerspectiveCamera;n.lookAt(new THREE.Vector3(r.lookAt.x,r.lookAt.y,r.lookAt.z)),n.fov=r.fov,n.aspect=r.aspect,n.near=r.near,n.far=r.far,n.position.set(r.position.x,r.position.y,r.position.z),this._setCamera(n)}i.resolve()}return i.promise}render(){this._camera&&this._renderer.render(this.scene,this._camera)}};__decorate([e.Watch({converter:e.PropertyConverters.Boolean})],r.prototype,"orbit",void 0),r=__decorate([e.CustomElement({tagName:e.P+"-3d-adapter-three"})],r),t.PacemThreeAdapterElement=r}(t.ThreeD||(t.ThreeD={}))}(e.Components||(e.Components={}))}(Pacem||(Pacem={}));