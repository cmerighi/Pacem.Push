/**
 * pacem v0.10.0-jericho (https://js.pacem.it)
 * Copyright 2020 Pacem (https://pacem.it)
 * Licensed under MIT
 */
var Pacem,__decorate=this&&this.__decorate||function(e,t,i,r){var s,a=arguments.length,n=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(n=(a<3?s(n):a>3?s(t,i,n):s(t,i))||n);return a>3&&n&&Object.defineProperty(t,i,n),n},__classPrivateFieldSet=this&&this.__classPrivateFieldSet||function(e,t,i){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,i),i},__classPrivateFieldGet=this&&this.__classPrivateFieldGet||function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)};!function(e){!function(t){var i;function r(t){return!e.Utils.isNull(t)&&"stage"in t}function s(e){return r(e)}t.isDrawable=r,t.isUiObject=s,t.isShape=function(e){return s(e)&&"pathData"in e},t.isGroup=function(t){return s(t)&&"items"in t&&!e.Utils.isNullOrEmpty(t.items)},t.isText=function(e){return s(e)&&"text"in e&&"string"==typeof e.text},t.isImage=function(e){return s(e)&&"src"in e&&"string"==typeof e.src};class UI2DEvent extends e.CustomUIEvent{constructor(e,t,r,s){super(e,t,r),i.set(this,void 0),__classPrivateFieldSet(this,i,s)}get transformMatrix(){return __classPrivateFieldGet(this,i)}project(t={x:this.screenX,y:this.screenY}){return e.Matrix2D.multiply(t,__classPrivateFieldGet(this,i))}}i=new WeakMap,t.UI2DEvent=UI2DEvent;t.DragEvent=class DragEvent extends UI2DEvent{};t.DrawableEvent=class DrawableEvent extends UI2DEvent{constructor(e,t,i,r){super(e,{detail:t,bubbles:!0,cancelable:!0},i,r)}}}(e.Drawing||(e.Drawing={}))}(Pacem||(Pacem={})),function(e){!function(t){!function(i){i.TAG_MIDDLE_NAME="2d",i.TWO_PI=2*Math.PI;const r=Math.PI/180;i.Pacem2DAdapterElement=class Pacem2DAdapterElement extends t.PacemEventTarget{constructor(){super(...arguments),this.DefaultShapeValues={stroke:"#000",lineWidth:1,fill:"#fff"}}};class DrawableElement extends t.PacemCrossItemsContainerElement{validate(e){return!1}findContainer(){return this.parent||this.stage}get stage(){return this._scene=this._scene||e.CustomElementUtils.findAncestorOfType(this,i.Pacem2DElement)}get parent(){return this._drawableParent=this._drawableParent||e.CustomElementUtils.findAncestor(this,e=>e instanceof DrawableElement)}disconnectedCallback(){delete this._scene,delete this._drawableParent,super.disconnectedCallback()}propertyChangedCallback(t,i,r,s){switch(super.propertyChangedCallback(t,i,r,s),t){case"hide":case"items":const a=this.stage;e.Utils.isNull(a)||("hide"===t?a.draw(this):a.requestDraw(this,!0))}}}__decorate([e.Watch({emit:!1,reflectBack:!0,converter:e.PropertyConverters.String})],DrawableElement.prototype,"tag",void 0),__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.Boolean})],DrawableElement.prototype,"inert",void 0),i.DrawableElement=DrawableElement;class UiElement extends DrawableElement{constructor(){super(...arguments),this._transformMatrix=e.Matrix2D.identity}propertyChangedCallback(t,i,r,s){if(!s)switch(t){case"rotate":case"scaleX":case"scaleY":case"translateX":case"translateY":this._updateTransformMatrix();case"opacity":e.Utils.isNull(this.stage)||this.stage.draw(this)}}_updateTransformMatrix(){let e=r*(this.rotate||0),t=Math.cos(e),i=Math.sin(e),s=this.scaleX*t,a=-i,n=i,o=this.scaleY*t,l=this.translateX,c=this.translateY;this._transformMatrix={a:s,b:a,c:n,d:o,e:l,f:c}}get transformMatrix(){const e=this._transformMatrix;return{a:e.a,b:e.b,c:e.c,d:e.d,e:e.e,f:e.f}}}__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.Number})],UiElement.prototype,"rotate",void 0),__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.Number})],UiElement.prototype,"scaleX",void 0),__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.Number})],UiElement.prototype,"scaleY",void 0),__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.Number})],UiElement.prototype,"translateX",void 0),__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.Number})],UiElement.prototype,"translateY",void 0),__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.Number})],UiElement.prototype,"opacity",void 0),i.UiElement=UiElement;class ShapeElement extends UiElement{propertyChangedCallback(t,i,r,s){if(!s)switch(t){case"data":case"stroke":case"lineWidth":case"fill":e.Utils.isNull(this.stage)||this.stage.draw(this)}}viewActivatedCallback(){super.viewActivatedCallback(),this.data=this.getPathData()}get pathData(){return this.data}}__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.String})],ShapeElement.prototype,"data",void 0),__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.String})],ShapeElement.prototype,"stroke",void 0),__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.Number})],ShapeElement.prototype,"lineWidth",void 0),__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.String})],ShapeElement.prototype,"fill",void 0),__decorate([e.Watch({emit:!1,converter:{convert:e=>null==e?void 0:e.split(",").map(e=>parseInt(e)).filter(e=>!Number.isNaN(e)),convertBack:e=>null==e?void 0:e.join(",")}})],ShapeElement.prototype,"dashArray",void 0),__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.String})],ShapeElement.prototype,"lineJoin",void 0),__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.String})],ShapeElement.prototype,"lineCap",void 0),i.ShapeElement=ShapeElement}(t.Drawing||(t.Drawing={}))}(e.Components||(e.Components={}))}(Pacem||(Pacem={})),function(e){!function(t){!function(t){var i;let r=i=class PacemCircleElement extends t.ShapeElement{propertyChangedCallback(e,t,i,r){if(super.propertyChangedCallback(e,t,i,r),!r)switch(e){case"center":case"radius":this.data=this.getPathData()}}getPathData(){const t=this.radius,r=this.center;return e.Utils.isNull(r)||e.Utils.isNull(t)?null:i.getPathData(r,t)}get boundingRect(){var e=this.center,t=this.radius,i=2*t;return{x:e.x-t,y:e.y-t,width:i,height:i}}static getPathData(e={x:NaN,y:NaN},t=NaN){const i=2*t;return`M ${e.x} ${e.y} m ${-t}, 0 a ${t},${t} 0 1,1 ${i},0 a ${t},${t} 0 1,1 ${-i},0`}};__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.Point})],r.prototype,"center",void 0),__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.Number})],r.prototype,"radius",void 0),r=i=__decorate([e.CustomElement({tagName:e.P+"-"+t.TAG_MIDDLE_NAME+"-circle"})],r),t.PacemCircleElement=r}(t.Drawing||(t.Drawing={}))}(e.Components||(e.Components={}))}(Pacem||(Pacem={})),function(e){!function(t){!function(t){let i=class PacemGroupElement extends t.DrawableElement{validate(e){return e instanceof t.DrawableElement&&e.parent===this}};i=__decorate([e.CustomElement({tagName:e.P+"-"+t.TAG_MIDDLE_NAME+"-group"})],i),t.PacemGroupElement=i}(t.Drawing||(t.Drawing={}))}(e.Components||(e.Components={}))}(Pacem||(Pacem={})),function(e){!function(t){!function(t){let i=class PacemImageElement extends t.UiElement{propertyChangedCallback(t,i,r,s){if(!s)switch(t){case"src":case"x":case"y":case"width":case"height":e.Utils.isNull(this.stage)||this.stage.draw(this)}}};__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.String})],i.prototype,"src",void 0),__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.Number})],i.prototype,"x",void 0),__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.Number})],i.prototype,"y",void 0),__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.Number})],i.prototype,"width",void 0),__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.Number})],i.prototype,"height",void 0),i=__decorate([e.CustomElement({tagName:e.P+"-"+t.TAG_MIDDLE_NAME+"-image"})],i),t.PacemImageElement=i}(t.Drawing||(t.Drawing={}))}(e.Components||(e.Components={}))}(Pacem||(Pacem={})),function(e){!function(t){!function(t){let i=class PacemPathElement extends t.ShapeElement{constructor(){super(...arguments),this.getPathData=(()=>this.d)}propertyChangedCallback(e,t,i,r){super.propertyChangedCallback(e,t,i,r),"d"===e&&(this.data=this.getPathData())}};__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.String})],i.prototype,"d",void 0),__decorate([e.Watch({converter:e.PropertyConverters.Json})],i.prototype,"boundingRect",void 0),i=__decorate([e.CustomElement({tagName:e.P+"-"+t.TAG_MIDDLE_NAME+"-path"})],i),t.PacemPathElement=i}(t.Drawing||(t.Drawing={}))}(e.Components||(e.Components={}))}(Pacem||(Pacem={})),function(e){!function(t){!function(t){var i;let r=i=class PacemRectElement extends t.ShapeElement{propertyChangedCallback(e,t,i,r){super.propertyChangedCallback(e,t,i,r),r||"x"!==e&&"y"!==e&&"w"!==e&&"h"!==e||(this.data=this.getPathData())}getPathData(){const t=this.x,r=this.y,s=this.w,a=this.h;return e.Utils.isNull(t)||e.Utils.isNull(r)||e.Utils.isNull(s)||e.Utils.isNull(a)?null:i.getPathData(t,r,s,a)}get boundingRect(){return{x:this.x,y:this.y,width:this.w,height:this.h}}static getPathData(e=NaN,t=NaN,i=NaN,r=NaN){return`M ${e} ${t} h ${i} v ${r} h ${-i} z`}};__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.Number})],r.prototype,"x",void 0),__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.Number})],r.prototype,"y",void 0),__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.Number})],r.prototype,"w",void 0),__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.Number})],r.prototype,"h",void 0),r=i=__decorate([e.CustomElement({tagName:e.P+"-"+t.TAG_MIDDLE_NAME+"-rect"})],r),t.PacemRectElement=r}(t.Drawing||(t.Drawing={}))}(e.Components||(e.Components={}))}(Pacem||(Pacem={})),function(e){!function(t){!function(i){var r;const s=/^\s*[xX]\s*([Mm](in|ax|id))\s*[yY]\s*([Mm](in|ax|id))(\s+(none|slice|meet))?\s*$/,a={convert:e=>{const t=s.exec(e);return t&&t.length>=4?{x:t[1].toLowerCase(),y:t[3].toLowerCase(),slice:"slice"===t[6]}:"none"},convertBack:t=>e.Utils.isNull(t)||"string"==typeof t?"none":`xM${t.x.substr(1)}YM${t.y.substr(1)} ${t.slice?"slice":"meet"}`},n={panControl:!0,zoomControl:!0,panModifiers:[e.EventKeyModifier.AltKey],zoomModifiers:[e.EventKeyModifier.AltKey]};let o=class Pacem2DElement extends t.PacemItemsContainerElement{constructor(){super(...arguments),r.set(this,e.Matrix2D.identity),this._options=n,this._resizeHandler=(t=>{this._size={width:t.detail.width,height:t.detail.height};const i=this.adapter;e.Utils.isNull(i)||this._invalidateSize()}),this._zoomHandler=(t=>{const i=this._options;if(i.zoomControl&&e.CustomEventUtils.matchModifiers(t,i.zoomModifiers)){e.avoidHandler(t);const i=this._size,r=t.deltaY<0,s=this.viewbox||{x:0,y:0,width:i.width,height:i.height},a=1+.1*(r?-1:1),n=Math.min(s.width,s.height),o=n*a,l=n*a;if(o>0&&l>0){const i=this._getActualAspectRatio(),r=i.x,a=i.y,n=i.slice,c=e.Utils.offsetRect(t.currentTarget),h=s.width/s.height,d=n?Math.max(c.width,c.height):Math.min(c.width,c.height),m={x:t.clientX,y:t.clientY};let p,u;switch(r){case"mid":p=(o-s.width)*(m.x-c.x-.5*(c.width-d))/(d*h);break;case"max":p=(o-s.width)*(m.x-c.x-(c.width-d))/(d*h);break;default:p=(o-s.width)*(m.x-c.x)/(d*h)}switch(a){case"mid":u=(l-s.height)*(m.y-c.y-.5*(c.height-d))/(d*h);break;case"max":u=(l-s.height)*(m.y-c.y-(c.height-d))/(d*h);break;default:u=(l-s.height)*(m.y-c.y)/(d*h)}const v=s.x-p,_=s.y-u;this.viewbox={x:v,y:_,width:o,height:l}}}}),this._panHandler=(t=>{const i=this._panningStart,r=this._getPanPoint(t);if(!e.Utils.isNullOrEmpty(i&&i.point)&&!e.Utils.isNull(r)){const e=i.factor,t=i.box,s=i.point;this.viewbox={x:t.x-e*(r.x-s.x),y:t.y-e*(r.y-s.y),width:t.width,height:t.height}}}),this._panStartHandler=(t=>{if(!this._options.panControl)return;const i=this._size,r=this.viewbox||{x:0,y:0,width:i.width,height:i.height},s=this._getPanPoint(t);if(s){e.avoidHandler(t),this._stage.style.pointerEvents="none";const a=this._getActualAspectRatio(),n=r.width/i.width,o=r.height/i.height,l=a.slice?Math.min(n,o):Math.max(n,o);this._panningStart={point:s,box:r,factor:l}}}),this._panEndHandler=(e=>{this._stage.style.pointerEvents="",this._panningStart=null})}get stage(){return this._stage}get transformMatrix(){return __classPrivateFieldGet(this,r)}validate(t){return t instanceof i.DrawableElement&&e.Utils.isNull(t.parent)}draw(t,i=!1){const r=this.adapter;if(!this.disabled&&!e.Utils.isNull(r)){let e=new CustomEvent("predraw",{cancelable:!0});this.dispatchEvent(e),e.defaultPrevented||(r.draw(this,t,i),this.dispatchEvent(new CustomEvent("draw")))}}_drawDebounced(t,i=!1){!e.Utils.isNull(t)&&e.Drawing.isGroup(t)?this.draw(t,i):this.draw(t)}requestDraw(e,t=!1){this._drawDebounced(e,t)}_buildUpDatasourceFromDOM(){this.datasource=(this.items||[]).slice()}_getActualAspectRatio(){const e=this.aspectRatio||"none";return{x:"none"===e?"mid":e.x,y:"none"===e?"mid":e.y,slice:"none"!==e&&e.slice}}_getPanPoint(t){const i=this._options;return t instanceof MouseEvent&&e.CustomEventUtils.matchModifiers(t,i.panModifiers)?e.CustomEventUtils.getEventCoordinates(t).page:null}_invalidateSize(){this.adapter.invalidateSize(this,this._size),__classPrivateFieldSet(this,r,this.adapter.getTransformMatrix(this)),this.dispatchEvent(new t.ResizeEvent(this._size))}viewActivatedCallback(){super.viewActivatedCallback();const t=this.adapter;e.Utils.isNull(t)||(t.initialize(this),this._invalidateSize(),this._drawDebounced());const i=this._resize;i.addEventListener(e.Components.ResizeEventName,this._resizeHandler,!1);const r=this._stage;i.target=r;const s={capture:!1,passive:!0};r.addEventListener("wheel",this._zoomHandler,!1),r.addEventListener("mousedown",this._panStartHandler,!1),r.addEventListener("touchstart",this._panStartHandler,s),window.addEventListener("mousemove",this._panHandler,!1),window.addEventListener("mouseup",this._panEndHandler,!1),window.addEventListener("touchmove",this._panHandler,s),window.addEventListener("touchend",this._panEndHandler,s)}propertyChangedCallback(t,i,r,s){switch(super.propertyChangedCallback(t,i,r,s),t){case"adapter":e.Utils.isNull(i)||r.dispose(this),e.Utils.isNull(r)||(r.initialize(this),this._drawDebounced());break;case"aspectRatio":case"viewbox":e.Utils.isNull(this.adapter)||this._invalidateSize();break;case"items":this._buildUpDatasourceFromDOM();break;case"options":this._options=e.Utils.extend({},n,r||{});break;case"disabled":case"datasource":this._drawDebounced()}}disconnectedCallback(){const t=this._resize,i=this._stage;e.Utils.isNull(t)||t.removeEventListener(e.Components.ResizeEventName,this._resizeHandler,!1),e.Utils.isNull(i)||(i.removeEventListener("wheel",this._zoomHandler,!1),i.removeEventListener("mousedown",this._panStartHandler,!1),i.removeEventListener("touchstart",this._panStartHandler),window.removeEventListener("mousemove",this._panHandler,!1),window.removeEventListener("mouseup",this._panEndHandler,!1),window.removeEventListener("touchmove",this._panHandler),window.removeEventListener("touchend",this._panEndHandler)),e.Utils.isNull(this.adapter)||this.adapter.dispose(this),super.disconnectedCallback()}};r=new WeakMap,__decorate([e.Watch({converter:e.PropertyConverters.Element})],o.prototype,"adapter",void 0),__decorate([e.Watch({reflectBack:!0,converter:e.PropertyConverters.Rect})],o.prototype,"viewbox",void 0),__decorate([e.Watch({emit:!1,reflectBack:!0,converter:a})],o.prototype,"aspectRatio",void 0),__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.Json})],o.prototype,"datasource",void 0),__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.Json})],o.prototype,"options",void 0),__decorate([e.ViewChild("."+e.PCSS+"-2d")],o.prototype,"_stage",void 0),__decorate([e.ViewChild(e.P+"-resize")],o.prototype,"_resize",void 0),__decorate([e.Debounce(!0)],o.prototype,"_drawDebounced",null),o=__decorate([e.CustomElement({tagName:e.P+"-"+i.TAG_MIDDLE_NAME,shadow:e.Defaults.USE_SHADOW_ROOT,template:`<${e.P}-resize></${e.P}-resize><div class="${e.PCSS}-2d"></div><pacem-content></pacem-content>`})],o),i.Pacem2DElement=o}(t.Drawing||(t.Drawing={}))}(e.Components||(e.Components={}))}(Pacem||(Pacem={})),function(e){!function(t){!function(t){let i=class PacemTextElement extends t.UiElement{propertyChangedCallback(t,i,r,s){if(!s)switch(t){case"text":case"color":case"fontFamily":case"fontSize":case"anchor":e.Utils.isNull(this.stage)||this.stage.draw(this)}}};__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.String})],i.prototype,"text",void 0),__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.String})],i.prototype,"color",void 0),__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.String})],i.prototype,"fontFamily",void 0),__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.Number})],i.prototype,"fontSize",void 0),__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.Point})],i.prototype,"anchor",void 0),__decorate([e.Watch({emit:!1,converter:e.PropertyConverters.String})],i.prototype,"textAnchor",void 0),i=__decorate([e.CustomElement({tagName:e.P+"-"+t.TAG_MIDDLE_NAME+"-text"})],i),t.PacemTextElement=i}(t.Drawing||(t.Drawing={}))}(e.Components||(e.Components={}))}(Pacem||(Pacem={})),function(e){!function(t){!function(t){Math.PI;function i(t){return"none"===t||e.Utils.isNullOrEmpty(t)}function r(t,i){return e.Utils.isNull(t)?i:t}let s=class PacemCanvasAdapterElement extends t.Pacem2DAdapterElement{constructor(){super(...arguments),this._pointer={page:{x:0,y:0},screen:{x:0,y:0},client:{x:0,y:0}},this._canvasOffset={x:0,y:0,width:0,height:0},this._clickHandler=(t=>{const i=this._hitTarget;if(!e.Utils.isNull(i)){const r=i.stage.transformMatrix;i instanceof Element&&i.dispatchEvent(new e.Drawing.DrawableEvent("click",i,t,r)),i.stage.dispatchEvent(new e.Drawing.DrawableEvent("itemclick",i,t,r))}}),this._mousemoveHandler=(t=>{this._scopeEvent=t,this._pointer=e.CustomEventUtils.getEventCoordinates(t)}),this._touchstartHandler=(t=>{1===t.touches.length&&(this._scopeEvent=t,this._pointer=e.CustomEventUtils.getEventCoordinates(t))}),this._scenes=new WeakMap,this._handles=new WeakMap}snapshot(e){return new Promise((t,i)=>{const r=this._scenes;r.has(e)?r.get(e).context.canvas.toBlob(e=>{t(e)},"image/png"):t(null)})}getTransformMatrix(t){const i=this._scenes;return i.has(t)?i.get(t).transformMatrix:e.Matrix2D.identity}invalidateSize(t,i){const r=this._scenes;if(!e.Utils.isNull(t)&&!e.Utils.isNullOrEmpty(i)&&r.has(t)){var s=r.get(t).context;s.canvas.width=i.width,s.canvas.height=i.height,this._canvasOffset=e.Utils.offsetRect(s.canvas)}}getHitTarget(t){const i=this._hitTarget;return e.Utils.isNull(i)||i.stage!==t?null:i}initialize(t){if(e.Utils.isNull(t))throw"Provided scene is null or undefined.";const i=this._scenes;if(i.has(t))return i.get(t).context.canvas;const r=t.stage;r.innerHTML="";var s=document.createElement("canvas"),a=s.getContext("2d");return s.addEventListener("mousemove",this._mousemoveHandler,!1),s.addEventListener("touchstart",this._touchstartHandler,{passive:!0}),s.addEventListener("touchmove",this._touchstartHandler,{passive:!0}),s.addEventListener("touchend",this._clickHandler,{passive:!0}),s.addEventListener("click",this._clickHandler,!1),r.appendChild(s),i.set(t,{context:a,transformMatrix:e.Matrix2D.identity}),s}_requestDraw(e){const t=this._handles;t.has(e)&&cancelAnimationFrame(t.get(e)),t.set(e,requestAnimationFrame(()=>{this.draw(e)}))}dispose(e){const t=this._scenes;if(t.has(e)){var i=t.get(e).context;i.canvas.removeEventListener("click",this._clickHandler,!1),i.canvas.removeEventListener("touchend",this._clickHandler,!1),i.canvas.removeEventListener("touchmove",this._touchstartHandler),i.canvas.removeEventListener("touchstart",this._touchstartHandler),i.canvas.removeEventListener("mousemove",this._mousemoveHandler,!1),i.canvas.remove(),t.delete(e)}}draw(t){const i=this._scenes,r=this._handles;if(!e.Utils.isNull(t)){if(t.adapter!==this)return void(i.has(t)&&(i.delete(t),r.get(t)));if(!i.has(t))return void this.initialize(t);r.has(t)&&cancelAnimationFrame(r.get(t));const s=this._hitTarget,a=t.datasource||[];this._hitTarget=null;const n=i.get(t),o=n.context,l=o.canvas;o.clearRect(0,0,l.width,l.height);const c=n.transformMatrix=this._resetTransform(t.viewbox,o);for(let e of a)this._draw(o,e);const h=this._hitTarget;h!=s&&(e.Utils.isNull(s)||(s instanceof Element&&s.dispatchEvent(new e.Drawing.DrawableEvent("out",s,this._scopeEvent,c)),t.dispatchEvent(new e.Drawing.DrawableEvent("itemout",s,this._scopeEvent,c))),e.Utils.isNull(h)||(h instanceof Element&&h.dispatchEvent(new e.Drawing.DrawableEvent("over",h,this._scopeEvent,c)),t.dispatchEvent(new e.Drawing.DrawableEvent("itemover",h,this._scopeEvent,c)))),this._requestDraw(t)}}_resetTransform(t,i){i.resetTransform();const r=t,s=i.canvas;if(!e.Utils.isNull(r)){const e=s.width,t=s.height,a=1/Math.min(r.width/e,r.height/t),n=a,o=0,l=0,c=a,h=e/2-a*r.x,d=t/2-a*r.y;return i.transform(n,o,l,c,h,d),{a:n,b:o,c:l,d:c,e:h,f:d}}}_hasItems(t){return"items"in t&&e.Utils.isArray(t.items)}_draw(t,s){var a;const n=this.DefaultShapeValues;if(!e.Drawing.isDrawable(s)||!s.hide){if(!e.Utils.isNull(t)&&e.Drawing.isShape(s)&&!e.Utils.isNullOrEmpty(a=s.pathData)){t.strokeStyle=r(s.stroke,n.stroke),t.lineWidth=r(s.lineWidth,n.lineWidth),e.Utils.isNullOrEmpty(s.dashArray)||t.setLineDash(s.dashArray),e.Utils.isNullOrEmpty(s.lineCap)||(t.lineCap=s.lineCap),e.Utils.isNullOrEmpty(s.lineJoin)||(t.lineJoin=s.lineJoin),t.lineWidth=r(s.lineWidth,n.lineWidth),t.fillStyle=r(s.fill,n.fill),t.globalAlpha=r(s.opacity,1);let l=s.transformMatrix;e.Utils.isNull(l)||e.Matrix2D.isIdentity(l)||t.transform(l.a,l.b,l.c,l.d,l.e,l.f),t.beginPath();const c=!i(s.fill),h=!i(s.stroke);var o=new Path2D(a);const d=this._pointer,m=this._canvasOffset,p={x:d.page.x-m.x,y:d.page.y-m.y};s.inert||e.Utils.isNull(d)||(c&&t.isPointInPath(o,p.x,p.y)||h&&t.isPointInStroke(o,p.x,p.y))&&(this._hitTarget=s),h&&t.stroke(o),c&&t.fill(o),t.lineWidth=1,t.strokeStyle="#000",t.setLineDash([]),t.lineCap="butt",t.lineJoin="miter",this._resetTransform(s.stage.viewbox,t)}if(e.Drawing.isDrawable(s)&&this._hasItems(s)&&!s.hide){if(e.Drawing.isUiObject(s)){const i=s.transformMatrix;e.Utils.isNull(i)||e.Matrix2D.isIdentity(i)||t.transform(i.a,i.b,i.c,i.d,i.e,i.f)}for(let e of s.items||[])this._draw(t,e)}}}};s=__decorate([e.CustomElement({tagName:e.P+"-"+t.TAG_MIDDLE_NAME+"-canvas-adapter"})],s),t.PacemCanvasAdapterElement=s}(t.Drawing||(t.Drawing={}))}(e.Components||(e.Components={}))}(Pacem||(Pacem={})),function(e){!function(t){!function(t){const i="http://www.w3.org/2000/svg";function r(t,i){return e.Utils.isNull(t)?i:t}function s(e,t,i){return i>=e.children.length?(e.appendChild(t),null):e.replaceChild(t,e.children.item(i))}let a=class PacemSvgAdapterElement extends t.Pacem2DAdapterElement{constructor(){super(...arguments),this._hitTarget=null,this._dragInitHandler=(t=>{const i=t.detail,r=i.element,s=e.CustomElementUtils.getAttachedPropertyValue(r,"pacem:drawable"),a=s.stage.transformMatrix,n=e.Utils.deserializeTransform(r.style);i.data={transformMatrix:a,item:s,initialTransformMatrix:n},this._itemDispatch(s,t,{x:0,y:0})&&t.preventDefault()}),this._draggingHandler=(t=>{e.avoidHandler(t),this._dragging=!0;const i=t.detail.element,r=t.detail.data,s=t.detail,a={x:(s.currentPosition.x-s.origin.x)*r.transformMatrix.a+r.initialTransformMatrix.e,y:(s.currentPosition.y-s.origin.y)*r.transformMatrix.d+r.initialTransformMatrix.f};this._itemDispatch(r.item,t,a)||(i.style.transform=`matrix(1,0,0,1,${a.x},${a.y})`)}),this._dragEndHandler=(t=>{this._dragging=!1;const i=t.detail,r=i.data,s=e.Utils.deserializeTransform(i.element.style);this._itemDispatch(r.item,t,{x:s.e,y:s.f})}),this._mousemoveHandler=(t=>{var i=e.CustomEventUtils.getEventCoordinates(t).client;if(!this._dragging){var r=null,s=(document.elementsFromPoint(i.x,i.y).find(t=>(r=e.CustomElementUtils.getAttachedPropertyValue(t,"pacem:drawable"))&&!r.inert),this._hitTarget),a=r;(e.Utils.isNull(r&&r.stage)||!this._scenes.has(r.stage)||r.inert)&&(a=null),this._hitTarget=a,a!==s&&(e.Utils.isNull(s)||(this._dragger.unregister(this._items.get(s)),this._itemDispatch(s,"out",t)),e.Utils.isNull(a)||(a.draggable&&this._dragger.register(this._items.get(a)),this._itemDispatch(a,"over",t)))}}),this._mouseDownUpHandler=(t=>{if(!e.Utils.isNull(this._hitTarget)){const e=t.type.replace(/^mouse/,"");this._itemDispatch(this._hitTarget,e,t)}}),this._scenes=new WeakMap,this._items=new WeakMap}snapshot(t,i){return new Promise((r,s)=>{if(this._scenes.has(t)){const s=this._scenes.get(t);e.Utils.snapshotElement(s,i).then(e=>{r(e)})}else r(null)})}getTransformMatrix(t){const i=this._scenes;return i.has(t)?i.get(t).getScreenCTM().inverse():e.Matrix2D.identity}viewActivatedCallback(){super.viewActivatedCallback();const t=this._dragger=document.createElement(e.P+"-drag-drop");t.mode=e.UI.DragDataMode.Self,e.CustomElementUtils.findAncestorShell(this).appendChild(t),t.addEventListener(e.UI.DragDropEventType.Init,this._dragInitHandler,!1),t.addEventListener(e.UI.DragDropEventType.Drag,this._draggingHandler,!1),t.addEventListener(e.UI.DragDropEventType.End,this._dragEndHandler,!1)}disconnectedCallback(){const t=this._dragger;e.Utils.isNull(t)||(t.removeEventListener(e.UI.DragDropEventType.Init,this._dragInitHandler,!1),t.removeEventListener(e.UI.DragDropEventType.Drag,this._draggingHandler,!1),t.removeEventListener(e.UI.DragDropEventType.End,this._dragEndHandler,!1),t.remove()),super.disconnectedCallback()}invalidateSize(t,i){const r=this._scenes;if(!e.Utils.isNull(t)&&!e.Utils.isNullOrEmpty(i)&&r.has(t)){var s=r.get(t);s.setAttribute("width",i.width+""),s.setAttribute("height",i.height+"");const a=t.viewbox,n=t.aspectRatio;e.Utils.isNullOrEmpty(a)?s.removeAttribute("viewBox"):s.setAttribute("viewBox",`${a.x} ${a.y} ${a.width} ${a.height}`),e.Utils.isNullOrEmpty(n)||"string"==typeof n?s.removeAttribute("preserveAspectRatio"):s.setAttribute("preserveAspectRatio",`xM${n.x.substr(1)}YM${n.y.substr(1)} ${n.slice?"slice":"meet"}`)}}initialize(t){if(e.Utils.isNull(t))throw"Provided scene is null or undefined.";const r=this._scenes;if(r.has(t))return r.get(t);const s=t.stage;s.innerHTML="",this._items=new WeakMap;var a=document.createElementNS(i,"svg");s.appendChild(a),r.set(t,a);return a.addEventListener("mousemove",this._mousemoveHandler,!1),a.addEventListener("click",this._mouseDownUpHandler,!1),a.addEventListener("mousedown",this._mouseDownUpHandler,!1),a.addEventListener("mouseup",this._mouseDownUpHandler,!1),a}dispose(e){const t=this._scenes;if(t.has(e)){var i=t.get(e);i.removeEventListener("mousemove",this._mousemoveHandler),i.removeEventListener("click",this._mouseDownUpHandler),i.removeEventListener("mousedown",this._mouseDownUpHandler),i.removeEventListener("mouseup",this._mouseDownUpHandler),i.remove(),t.delete(e)}}getHitTarget(e){return this._hitTarget}draw(t,i,r=!1){const s=this._scenes,a=this._items;if(!e.Utils.isNull(t))if(t.adapter===this){s.has(t)||this.initialize(t);var n=t.datasource,o=!0,l=s.get(t);e.Utils.isNull(i)||a.has(i)&&(n=[i],l=a.get(i).parentNode,o=!1),o&&(l.innerHTML=""),this._draw(l,n||[],o,r)}else s.has(t)&&s.delete(t)}_itemDispatch(t,i,r){if(!e.Utils.isNull(t)){var s,a,n;r instanceof Event?a=r:s={item:t,offset:r},"string"==typeof i?n=i:(n=i.type,a=i.originalEvent);const l=t.stage.transformMatrix,c=()=>r instanceof Event?new e.Drawing.DrawableEvent(n,t,a,l):new e.Drawing.DragEvent(n,{detail:s,cancelable:n===e.UI.DragDropEventType.Init||n===e.UI.DragDropEventType.Drag},a,l),h=r instanceof Event?new e.Drawing.DrawableEvent("item"+n,t,a,l):new e.Drawing.DragEvent("item"+n,{detail:s,cancelable:n===e.UI.DragDropEventType.Init||n===e.UI.DragDropEventType.Drag},a,l);var o=!1;if(t instanceof EventTarget){const e=c();t.dispatchEvent(e),o=e.defaultPrevented}return t.stage.dispatchEvent(h),o||h.defaultPrevented}return!1}_hasItems(t){return e.Drawing.isGroup(t)}_disposeSvg(t){if(!e.Utils.isNull(t)){var i=e.CustomElementUtils.getAttachedPropertyValue(t,"pacem:drawable");this._items.delete(i)}}_draw(t,i,a,n){const o=this._items;let l=0;if(!e.Utils.isNullOrEmpty(i))for(let c of i){let i;if(o.has(c)?(i=o.get(c)).parentNode!==t&&this._disposeSvg(s(t,i,l)):(i=this._buildSVGElement(c),e.CustomElementUtils.setAttachedPropertyValue(i,"pacem:drawable",c),this._disposeSvg(s(t,i,l)),o.set(c,i)),e.Drawing.isDrawable(c)&&(c.hide?i.setAttribute("display","none"):i.removeAttribute("display"),i.style.transform="none"),e.Drawing.isShape(c)){const t=i,s=this.DefaultShapeValues;t.setAttribute("d",r(c.pathData,"M0,0")),t.setAttribute("fill",r(c.fill,s.fill)),t.setAttribute("stroke",r(c.stroke,s.stroke));let a="";e.Utils.isNullOrEmpty(c.dashArray)||(a+=`stroke-dasharray: ${c.dashArray.join(",")};`),e.Utils.isNullOrEmpty(c.lineCap)||(a+=`stroke-linecap: ${c.lineCap};`),e.Utils.isNullOrEmpty(c.lineJoin)||(a+=`stroke-linejoin: ${c.lineJoin};`),t.style.cssText=a,t.setAttribute("stroke-width",""+r(c.lineWidth,s.lineWidth))}else if(e.Drawing.isText(c)){const t=i;t.textContent=c.text,t.style.fill=e.Utils.isNullOrEmpty(c.color)?"":c.color,t.style.fontFamily=e.Utils.isNullOrEmpty(c.fontFamily)?"":c.fontFamily,t.style.fontSize=e.Utils.isNull(c.fontSize)?"":c.fontSize+"px",t.setAttribute("text-anchor",r(c.textAnchor,"start")),e.Utils.isNull(c.anchor)?(t.removeAttribute("x"),t.removeAttribute("y")):(t.setAttribute("x",c.anchor.x.toString()),t.setAttribute("y",c.anchor.y.toString()))}else if(e.Drawing.isImage(c)){const t=i;t.setAttribute("href",c.src),c.width>0?t.setAttribute("width",""+c.width):t.removeAttribute("width"),c.height>0?t.setAttribute("height",""+c.height):t.removeAttribute("height"),e.Utils.isNull(c.x)?t.removeAttribute("x"):t.setAttribute("x",""+c.x),e.Utils.isNull(c.y)?t.removeAttribute("y"):t.setAttribute("y",""+c.y)}if(e.Drawing.isUiObject(c)){const t=c.transformMatrix;e.Utils.isNull(t)||e.Matrix2D.isIdentity(t)?i.removeAttribute("transform"):i.setAttribute("transform",`matrix(${t.a} ${t.b} ${t.c} ${t.d} ${t.e} ${t.f})`);const s=r(c.opacity,1);1===s?i.removeAttribute("opacity"):i.setAttribute("opacity",""+s)}(a||n)&&this._hasItems(c)&&this._draw(i,c.items,!0,n),l++}if(a)for(let e=t.children.length-1;e>=l;e--){const i=t.children.item(e);this._disposeSvg(i),i.remove()}}_buildSVGElement(t){return e.Drawing.isShape(t)?document.createElementNS(i,"path"):e.Drawing.isText(t)?document.createElementNS(i,"text"):e.Drawing.isImage(t)?document.createElementNS(i,"image"):document.createElementNS(i,"g")}};a=__decorate([e.CustomElement({tagName:e.P+"-"+t.TAG_MIDDLE_NAME+"-svg-adapter"})],a),t.PacemSvgAdapterElement=a}(t.Drawing||(t.Drawing={}))}(e.Components||(e.Components={}))}(Pacem||(Pacem={}));